name: Integration Tests | Auth
on:
  workflow_dispatch:
    inputs:
      ios:
        description: 'üì± iOS'
        required: true
        default: true
        type: boolean
      tvos:
        description: 'üì∫ tvOS'
        required: true
        default: true
        type: boolean
      watchos:
        description: '‚åöÔ∏è watchOS'
        required: true
        default: true
        type: boolean
      hostedui-ios:
        description: 'üåµ HostedUI iOS'
        required: true
        default: true
        type: boolean
  workflow_call:

permissions:
    id-token: write
    contents: read

jobs:
  auth-integration-tests:
    name: Auth Integration Tests
    strategy:
      fail-fast: false
      matrix:
        platform: [iOS, tvOS, watchOS]
        exclude:
          - platform: ${{ github.event.inputs.ios == 'false' && 'iOS' || 'Dummy' }}
          - platform: ${{ github.event.inputs.tvos == 'false' && 'tvOS' || 'Dummy' }}
          - platform: ${{ github.event.inputs.watchos == 'false' && 'watchOS' || 'Dummy' }}
    uses: ./.github/workflows/run_integration_tests.yml
    with:
      scheme: ${{ matrix.platform == 'watchOS' && 'AuthIntegrationTestsWatch' || 'AuthIntegrationTests' }}
      platform: ${{ matrix.platform }}
      build_cache_key: AWSCognitoAuthPlugin-${{ matrix.platform }}-latest-build-main
      project_path: ./AmplifyPlugins/Auth/Tests/AuthHostApp/
      xcode_version: '14.3'
      resource_subfolder: auth
      timeout-minutes: 30
    secrets: inherit

  auth-ui-integration-test-iOS:
    if: ${{ inputs.hostedui-ios != 'false' }}
    uses: ./.github/workflows/run_integration_tests.yml
    with:
      scheme: AuthHostedUIApp
      platform: iOS
      build_cache_key: AWSCognitoAuthPlugin-iOS-latest-build-main
      project_path: ./AmplifyPlugins/Auth/Tests/AuthHostedUIApp/
      xcode_version: '14.3'
      resource_subfolder: auth
      timeout-minutes: 30
    secrets: inherit
